{% extends 'index.html' %}
{% load static %}
{% load humanize %}

{% block title %}
    {% if operation == 'crear' %}
        Crear Empleado
    {% else %}
        Empleado
    {% endif %}
{% endblock title %}

{% block button %}
    {% if operation == 'crear' %}
        <a type="button" class="btn btn-outline-primary d-flex align-items-center justify-content-center" href="{% url 'talento_humano:listarEmpleados' %}" style="width:40px">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>
            </svg>
        </a>
    {% else %}
        <div class="btn-group" role="group" aria-label="Basic example">
            <a type="button" class="btn btn-outline-primary d-flex align-items-center justify-content-center" href="{% url 'talento_humano:listarEmpleados' %}" style="width:40px">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>
                </svg>
            </a>
        </div>
    {% endif %}
{% endblock button %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Inicio</a></li>
    <li class="breadcrumb-item"><a href="{% url 'informacion:informacion' %}">Talento Humano</a></li>
    <li class="breadcrumb-item"><a href="{% url 'talento_humano:listarEmpleados' %}">Empleados</a></li>
    <li class="breadcrumb-item active" aria-current="page">{% if operation == 'crear' %}Crear{% else %}Detalle{% endif %} Empleado</li>
    {% if operation == 'editar' %}
            <li class="breadcrumb-item active" aria-current="page">{{ empleado.nombre }} {{ empleado.apellido }} - {{ empleado.numero_documento }}</li>
    {% endif %}
{% endblock breadcrumb %}

{% block contenidoPagina %}

    {% if operation == 'editar' %}
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Informaci√≥n</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="{% url 'talento_humano:empleadolistarHistorialLaboral' empleado.id %}">Historico</a>
            </li>
            {% if empleado.asociado %}
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="{% url 'asociado:verAsociado' empleado.asociado.id %}">Asociado Relacionado</a>
                </li>
            {% endif %}
        </ul>
    {% endif %}

    <div class="card" style="border: 0px">
        <div class="card-body">
            <form method="post">

                <!-- Mostrar errores generales del formulario -->
                {% if form.errors %}
                    <div class="alert alert-danger">
                        <ul class="mb-0">
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                {% csrf_token %}
                {% comment %} Primera Fila {% endcomment %}
                <div class="row">
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.tipo_documento.label_tag }}
                        {{ form.tipo_documento }} 
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.numero_documento.label_tag }}
                        {{ form.numero_documento }} 
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.nombre.label_tag }}
                        {{ form.nombre }} 
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.apellido.label_tag }}
                        {{ form.apellido }} 
                    </div>

                    <div class="col-12 col-md-6 col-lg-4 mb-3">
                        {{ form.fecha_nacimiento.label_tag }}
                        {{ form.fecha_nacimiento }} 
                    </div>
                
                    <div class="col-12 col-md-6 col-lg-4 mb-3">
                        {{ form.celular.label_tag }}
                        {{ form.celular }} 
                    </div>
                    <div class="col-12 col-lg-4 mb-3">
                        {{ form.correo.label_tag }}
                        {{ form.correo }} 
                    </div>
                
                    <div class="col-12 mb-3">
                        {{ form.direccion.label_tag }}
                        {{ form.direccion }} 
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.municipio.label_tag }}
                        {{ form.municipio }} 
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        {{ form.departamento.label_tag }}
                        {{ form.departamento }} 
                    </div>
                    {{ form.asociado }}
                </div>

                {% if operation == 'crear' %}
                    <button type="submit" class="btn btn-primary">Crear</button>
                {% else %}
                    <button type="submit" class="btn btn-primary">Guardar</button>
                {% endif %}
            </form>
        </div>
    </div>
{% endblock contenidoPagina %}

{% block extrajs %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const numeroDocumento = document.getElementById('id_numero_documento');

            const limpiarCampos = () => {
                document.getElementById('id_nombre').value = '';
                document.getElementById('id_apellido').value = '';
                document.getElementById('id_asociado').value = '';
                document.getElementById('id_celular').value = '';
                document.getElementById('id_correo').value = '';
                document.getElementById('id_direccion').value = '';
                document.getElementById('id_fecha_nacimiento').value = '';
                document.getElementById('id_municipio').value = '';
                document.getElementById('id_departamento').value = '';
            };
            
            numeroDocumento.addEventListener('blur', function () {
                const value = this.value;

                if (!value) {
                    limpiarCampos();
                    return;
                }

                fetch(`{% url 'talento_humano:validar_documento' %}?numero_documento=${value}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.existe) {
                            document.getElementById('id_nombre').value = data.nombre;
                            document.getElementById('id_apellido').value = data.apellido;
                            document.getElementById('id_asociado').value = data.id_asociado;
                            document.getElementById('id_celular').value = data.celular;
                            document.getElementById('id_correo').value = data.correo;
                            document.getElementById('id_direccion').value = data.direccion;
                            document.getElementById('id_fecha_nacimiento').value = data.fecha_nacimiento || '';
                            document.getElementById('id_municipio').value = data.municipio || '';
                            document.getElementById('id_departamento').value = data.departamento || '';
                        } else {
                            limpiarCampos();
                        }
                    })
                    .catch(() => limpiarCampos());
            });

        });
    </script>
{% endblock extrajs %}